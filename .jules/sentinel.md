## 2024-08-06 - Fix Path Traversal in Scaffolding
**Vulnerability:** The `scaffold.InstallFS` function was vulnerable to path traversal because it did not validate that file paths provided by the `fs.FS` were within the intended destination directory. A malicious `fs.FS` implementation could provide a path like `../evil.txt` to write files outside of the target directory.
**Learning:** This vulnerability existed because the code implicitly trusted the paths returned by the `fs.FS` interface. The `filepath.Join` function does not, by itself, prevent traversal attacks. It's crucial to validate that the final, absolute path is within the intended directory structure.
**Prevention:** Always resolve and validate file paths when dealing with input from external sources or interfaces that can be mocked, like `fs.FS`. Before writing to a file, ensure its absolute path has the expected directory prefix. Adding unit tests for security vulnerabilities like this is a great way to prevent regressions.