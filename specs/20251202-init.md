# Galho - Spec Final

## Objetivo
Framework para criar aplicações Go com React, GraphQL e múltiplos bancos de dados. Abstrai configurações repetitivas mantendo flexibilidade máxima.

## Stack
- **Backend**: Go, Cobra
- **GraphQL**: gqlgen, Relay
- **Database**: SQLc, golang-migrate  
- **Frontend**: React, Bun, Tailwind, DaisyUI, React Router
- **Build**: Embedding de assets em release, proxy em dev
- **Tasks**: mise
- **Desktop**: Eletrocromo (opcional)

## Princípios
- Convenção sobre configuração
- Registry explícito (sem auto-discovery)
- Estrutura livre (usuário escolhe nomes/organização)
- Framework detecta por conteúdo, não por caminho
- Minimalista e sem magia

## Estrutura de Projeto

```
projeto/
  cmd/
    server/
      main.go           # Cobra + registro de módulos
  internal/
    crm/
      db/
        sqlc.yaml
        queries.sql
        migrations/
          001_initial.sql
        *.go            # gerado
      api/
        schema.graphql
        gqlgen.yml
        resolver.go     # implementação
        *.go           # gerado
    admin/
      frontend/
        package.json    # Tailwind/Daisy/Relay
        bun.lockb
        node_modules/
        dist/          # gerado
        App.tsx
        *.tsx
  .mise/
    galho.toml         # gerado pelo framework
  mise.toml            # usuário customiza
```

## CLI Commands

```bash
framework init projeto-nome
framework generate module internal/path/nome
framework generate database internal/path/db
framework generate graphql internal/path/api
framework generate frontend internal/path/frontend
framework generate tasks
```

## Tasks Geradas

**`.mise/tasks.toml` (gerado):**
```toml
[tasks."gen:crm:db:sqlc"]
run = "sqlc generate -f internal/crm/db/sqlc.yaml"

[tasks."gen:crm:api:gqlgen"]  
run = "gqlgen generate -c internal/crm/api/gqlgen.yml"

[tasks."gen:admin:frontend:relay"]
run = """
relay-compiler \
  --src ./internal/admin/frontend \
  --schema ./internal/crm/api/schema.graphql \
  --language typescript
"""

[tasks.gen]
depends = ["gen:*"]
description = "Generate all code"
```

**`mise.toml` (usuário):**
```toml
_.file.includes = [".mise/tasks.toml"]

[tasks.dev]
run = "air"
```

## Detecção de Módulos

Framework detecta por conteúdo:
- **Database**: contém `sqlc.yaml`
- **GraphQL**: contém `schema.graphql` + `gqlgen.yml`
- **Frontend**: contém `package.json` + `App.tsx`

## Database

```
internal/*/db/
  sqlc.yaml          # config
  queries.sql        # queries SQL
  migrations/        # migrações numeradas
    001_*.sql
  *.go              # gerado pelo sqlc
```

## GraphQL

```
internal/*/api/
  schema.graphql     # schema GraphQL
  gqlgen.yml        # config
  resolver.go       # implementação dos resolvers
  *.go             # gerado pelo gqlgen
```

## Frontend

```
internal/*/frontend/
  package.json      # deps: Tailwind, DaisyUI, React Router, Relay
  bun.lockb
  node_modules/
  dist/            # build artifacts
  App.tsx          # entry point
  *.tsx           # componentes
  __generated__/  # tipos do Relay
```

**Framework scaffolda:**
- `package.json` com deps base
- `App.tsx` template usando Tailwind/Daisy/Router
- Config de build

**Usuário:**
- Edita `.tsx`
- `bun install` para deps extras

## Server/Runtime

- Usuário registra módulos explicitamente no `main.go`
- Framework fornece helpers para setup
- `http.Handler` compatível com Eletrocromo
- (detalhes a definir)

## Integração Eletrocromo

- Framework fornece `http.Handler` padrão
- Usuário passa para `eletrocromo` quando quiser GUI desktop
- Mesma aplicação roda web ou desktop

## Pendências

- Nome do framework
- API exata de registro de módulos
- Interfaces/structs do runtime
- Sistema de embedding/proxy de assets
